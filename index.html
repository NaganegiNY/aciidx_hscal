<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IIDX 旧作HS計算機</title>
    <style>
        :root {
            --theme-color: #86cecb; /* デフォルトはACの青 */
            --bg-glow: rgba(0, 204, 255, 0.05);
        }
        body { font-family: 'Hiragino Kaku Gothic ProN', sans-serif; background: #0a0a0c; color: #fff; text-align: center; padding: 10px; }
        .card { background: linear-gradient(145deg, #1a1a1e, #25252b); border-radius: 20px; padding: 20px; max-width: 450px; margin: 0 auto; box-shadow: 0 8px 30px rgba(0,0,0,0.7); border: 1px solid #333; }
        
        .mode-switch { display: flex; gap: 10px; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #444; background: #111; color: #888; cursor: pointer; font-weight: bold; transition: 0.3s; }
        
        /* ボタンのアクティブ色 */
        #btnAC.active { background: #86cecb; color: #000; border-color: #86cecb; box-shadow: 0 0 10px rgba(0,204,255,0.4); }
        #btnCS.active { background: #ce8689; color: #fff; border-color: #ce8689; box-shadow: 0 0 10px rgba(255,85,0,0.4); }

        .input-group { margin-bottom: 12px; text-align: left; }
        label { font-size: 0.8rem; color: var(--theme-color); margin-left: 5px; font-weight: bold; transition: 0.3s; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border-radius: 8px; border: 1px solid #444; background: #000; color: #fff; font-size: 1.1rem; box-sizing: border-box; }
        	
        /* 結果表示エリア：ここが動的に変わります */
        .result { margin-top: 20px; padding: 15px; border: 2px solid var(--theme-color); border-radius: 12px; background: var(--bg-glow); transition: 0.3s; }
        .hs-val { font-size: 2.5rem; color: var(--theme-color); font-weight: bold; transition: 0.3s; }
        
        .sud-val { font-size: 1.6rem; color: #ffcc00; margin-top: 5px; }
        .midori-val { font-size: 1.8rem; color: #55ff55; margin-top: 10px; font-weight: bold; border-top: 1px dashed #444; padding-top: 10px; }
        .towel-val { font-size: 1.3rem; color: #ff66aa; margin-top: 5px; font-style: italic; }
        .info { font-size: 0.75rem; color: #888; margin-top: 15px; line-height: 1.4; }
    </style>
</head>
<body>

<div class="card">
    <h2 id="title" style="margin:0 0 15px 0; color:var(--theme-color); font-size: 1.4rem; transition: 0.3s;">IIDX 旧作HS計算機</h2>
    
    <div class="mode-switch">
        <button id="btnAC" class="mode-btn active" onclick="setPlatform('AC')">AC</button>
        <button id="btnCS" class="mode-btn" onclick="setPlatform('CS')">CS (家庭用)</button>
    </div>

    <div class="input-group">
        <label>シリーズ</label>
        <select id="version" onchange="calc()"></select>
    </div>

    <div style="display: flex; gap: 10px;">
        <div class="input-group" style="flex: 1;">
            <label>目標 緑数字</label>
            <input type="number" id="targetMidori" value="300" oninput="calc()">
        </div>
        <div class="input-group" style="flex: 1;">
            <label>基準 SUD+</label>
            <input type="number" id="baseSud" value="0" oninput="calc()">
        </div>
    </div>
    
    <div class="input-group">
        <label>曲のBPM</label>
        <input type="number" id="bpm" value="150" oninput="calc()">
    </div>

    <div class="result">
        <div id="resHS" class="hs-val">-</div>
        <div id="resSUD" class="sud-val">-</div>
        <div id="resTowel" class="towel-val"></div>
        <div id="resMidori" class="midori-val">-</div>
    </div>
    
    <div class="info">
        ※緑数字は (1000 - SUD+) / (BPM * 倍率) * 174000 / 1000 で計算しています。<br>
        実機環境により微差が出る場合があります。©Naganegi_NY
    </div>
</div>

<script>
let currentPlatform = 'AC';

const hsData = {
    AC: [
        { name: "1st / substream", hs: [{l:"0.0", m:1.0}] },
        { name: "2nd ~ 4th", hs: [{l:"0.0", m:1.0}, {l:"1.0", m:2.0}] },
        { name: "5th ~ 10th", hs: [{l:"0.0", m:1.0}, {l:"1.0", m:2.0}, {l:"2.0", m:2.5}, {l:"3.0", m:3.0}] },
        { name: "IIDX RED", hs: [{l:"0.0", m:1.0}, {l:"1.0", m:2.0}, {l:"2.0", m:2.5}, {l:"3.0", m:3.0}, {l:"4.0", m:3.5}] },
        { name: "HAPPY SKY", hs: [{l:"0.0", m:1.0}, {l:"0.5", m:1.5}, {l:"1.0", m:2.0}, {l:"1.5", m:2.25}, {l:"2.0", m:2.5}, {l:"2.5", m:2.75}, {l:"3.0", m:3.0}, {l:"3.5", m:3.25}, {l:"4.0", m:3.5}] },
        { name: "DistorteD ~ DJT", hs: [{l:"0.0", m:1.0}, {l:"0.5", m:1.5}, {l:"1.0", m:2.0}, {l:"1.5", m:2.25}, {l:"2.0", m:2.5}, {l:"2.5", m:2.75}, {l:"3.0", m:3.0}, {l:"3.5", m:3.25}, {l:"4.0", m:3.5}, {l:"4.5", m:3.75}, {l:"5.0", m:4.0}] }
    ],
    CS: [
        { name: "3rd style", hs: [{l:"LS 2.0", m:0.33}, {l:"LS 1.0", m:0.66}, {l:"HS 0.0", m:1.0}, {l:"HS 1.0", m:2.0}, {l:"HS 2.0", m:3.0}, {l:"HS 3.0", m:4.0}] },
        { name: "4th style", hs: [{l:"LS 2.0", m:0.33}, {l:"LS 1.0", m:0.66}, {l:"HS 0.0", m:1.0}, {l:"HS 1.0", m:2.0}, {l:"HS 2.0", m:2.75}, {l:"HS 3.0", m:3.5}] },
        { name: "5th style", hs: [{l:"LS 1.0", m:0.66}, {l:"HS 0.0", m:1.0}, {l:"HS 1.0", m:2.0}, {l:"HS 2.0", m:2.5}, {l:"HS 3.0", m:3.0}] },
        { name: "6th style", hs: [{l:"LS 1.0", m:0.66}, {l:"HS 0.0", m:1.0}, {l:"HS 1.0", m:2.0}, {l:"HS 2.0", m:2.5}, {l:"HS 3.0", m:3.0}, {l:"HS 4.0", m:3.5}] },
        { name: "7th ~ 9th", hs: [{l:"HS 0.0", m:1.0}, {l:"HS 1.0", m:2.0}, {l:"HS 2.0", m:2.5}, {l:"HS 3.0", m:3.0}, {l:"HS 4.0", m:3.5}] },
        { name: "10th style", hs: [{l:"HS 0.0", m:1.0}, {l:"HS 0.5", m:1.5}, {l:"HS 1.0", m:2.0}, {l:"HS 1.5", m:2.25}, {l:"HS 2.0", m:2.5}, {l:"HS 2.5", m:2.75}, {l:"HS 3.0", m:3.0}, {l:"HS 3.5", m:3.25}, {l:"HS 4.0", m:3.5}] },
        { name: "RED ~ DistorteD", hs: [{l:"HS 0.0", m:1.0}, {l:"HS 0.5", m:1.5}, {l:"HS 1.0", m:2.0}, {l:"HS 1.5", m:2.25}, {l:"HS 2.0", m:2.5}, {l:"HS 2.5", m:2.75}, {l:"HS 3.0", m:3.0}, {l:"HS 3.5", m:3.25}, {l:"HS 4.0", m:3.5}, {l:"HS 4.5", m:3.75}, {l:"HS 5.0", m:4.0}] }
    ]
};

function setPlatform(p) {
    currentPlatform = p;
    
    // テーマカラー切り替え
    const root = document.documentElement;
    if (p === 'AC') {
        root.style.setProperty('--theme-color', '#86cecb');
        root.style.setProperty('--bg-glow', 'rgba(0, 204, 255, 0.05)');
    } else {
        root.style.setProperty('--theme-color', '#ce8689'); // CS用のオレンジ
        root.style.setProperty('--bg-glow', 'rgba(255, 85, 0, 0.05)');
    }

    document.getElementById('btnAC').classList.toggle('active', p === 'AC');
    document.getElementById('btnCS').classList.toggle('active', p === 'CS');
    
    const verSelect = document.getElementById('version');
    verSelect.innerHTML = "";
    hsData[p].forEach((v, idx) => {
        const opt = document.createElement('option');
        opt.value = idx;
        opt.innerText = v.name;
        verSelect.appendChild(opt);
    });
    verSelect.selectedIndex = hsData[p].length - 1;
    calc();
}

function calc() {
    const verIdx = document.getElementById('version').value;
    if (verIdx === "") return;
    
    const midori = parseFloat(document.getElementById('targetMidori').value);
    const bpm = parseFloat(document.getElementById('bpm').value);
    const baseSud = parseFloat(document.getElementById('baseSud').value);
    const currentList = hsData[currentPlatform][verIdx];

    let bestHS = null;
    let minDiff = 9999;
    let finalSud = 0;

    currentList.hs.forEach(hs => {
        let calcSud = 1000 - (midori * bpm * hs.m / 174);
        let diff = Math.abs(calcSud - baseSud);
        if (calcSud >= 0 && diff < minDiff) {
            minDiff = diff;
            bestHS = hs;
            finalSud = Math.round(calcSud);
        }
    });

    const resHS = document.getElementById('resHS');
    const resSUD = document.getElementById('resSUD');
    const resTowel = document.getElementById('resTowel');
    const resMidori = document.getElementById('resMidori');

    if (!bestHS) {
        resHS.innerText = "速すぎます";
        resSUD.innerText = "-"; resTowel.innerText = ""; resMidori.innerText = "";
    } else {
        resHS.innerText = (currentPlatform === 'AC' ? "HS " : "") + bestHS.l;
        resSUD.innerText = "SUD+: " + finalSud;
        let actualMidori = Math.round((1000 - finalSud) / (bpm * bestHS.m) * 174);
        resMidori.innerText = "緑数字: " + actualMidori;

        const isOldAC = currentPlatform === 'AC' && ["1st / substream", "2nd ~ 4th", "5th ~ 10th", "IIDX RED", "HAPPY SKY"].includes(currentList.name);
        const isOldCS = currentPlatform === 'CS' && ["3rd style", "4th style", "5th style", "6th style", "7th ~ 9th", "10th style"].includes(currentList.name);
        
        if (isOldAC || isOldCS) {
            resTowel.innerText = "タオル隠し: " + (finalSud / 10).toFixed(1) + "%";
        } else {
            resTowel.innerText = "";
        }
    }
}

window.onload = () => setPlatform('AC');
</script>
</body>
</html>
